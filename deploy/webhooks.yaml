apiVersion: v1
kind: ConfigMap
metadata:
  name: webhooks
  namespace: openshift-pipelines-operator
data:
  webhooks.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: webhooks-extension
      namespace: tekton-pipelines
      labels:
        app: webhooks-extension
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: webhooks-extension
      template:
        metadata:
          labels:
            app: webhooks-extension
        spec:
          containers:
            - name: webhooks-extension
              image: "github.com/tektoncd/experimental/webhooks-extension/cmd/extension"
              imagePullPolicy: Always
              ports:
                - containerPort: 8080
              livenessProbe:
                httpGet:
                  path: /liveness
                  port: 8080
              readinessProbe:
                httpGet:
                  path: /readiness
                  port: 8080
              env:
              - name: PORT
                value: "8080"
              - name: INSTALLED_NAMESPACE
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.namespace
              - name: DOCKER_REGISTRY_LOCATION
                value: DOCKER_REPO
          serviceAccountName: tekton-pipelines-controller

    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: webhooks-extension
      namespace: tekton-pipelines
      labels:
        app: webhooks-extension
        tekton-dashboard-extension: "true"
      annotations:
        tekton-dashboard-display-name: webhooks-extension
        tekton-dashboard-endpoints: "webhooks"
    spec:
      type: NodePort
      ports:
        - port: 8080
          targetPort: 8080
      selector:
        app: webhooks-extension
